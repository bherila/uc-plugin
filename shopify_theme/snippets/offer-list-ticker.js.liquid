{% if items and id %}
  <script>
    function setupOfferList() {
      const allBottles = JSON.parse('{{ items | escape_javascript }}').items;
      const offerId = '{{ id | escape_javascript }}';
      const containers = document.querySelectorAll('.offer-list-bottles');

      allBottles.forEach(offer => {
        const container = document.querySelector(`.offer-list-bottles[data-offer-id="${offerId}"]`);
        if (container) {
          const price = offer.maxVariantPriceAmount ? parseFloat(offer.maxVariantPriceAmount.toString()) : 0;
          let perchance = offer.percentChance ? parseFloat(offer.percentChance) : 0;
          perchance = Math.floor(perchance);
          const perchanceDisplay = perchance > 0 && perchance < 1 ? '<1%' : `${perchance}%`;

          const div = document.createElement('div');
          div.className = 'offer-item';
          div.setAttribute('data-value', price);
          div.setAttribute('data-title', offer.title);

          div.innerHTML = offer.featuredImageUrl && offer.featuredImageUrl.trim() !== '' ? `
            <div class="image-frame">
              <img src="${offer.featuredImageUrl}" alt="${offer.title}">
            </div>
            <div class="offer-details">
              <div class="detail-price visible-detail">
                <span class="offer-price">$${price}</span>
                <span class="offer-value">VALUE</span>
              </div>
              <div class="detail-chance hidden-detail">
                <span class="offer-price">${perchanceDisplay}</span>
                <span class="offer-value">OF OFFER</span>
              </div>
            </div>
            <div class="offer-title">
              <span>${offer.title}</span>
            </div>
          ` : `
            <div class="image-frame no-image">
              <span>No Image</span>
            </div>
            <div class="offer-details">
              <div class="detail-price visible-detail">
                <span class="offer-price">$${price}</span>
                <span class="offer-value">VALUE</span>
              </div>
              <div class="detail-chance hidden-detail">
                <span class="offer-price">${perchanceDisplay}</span>
                <span class="offer-value">OF OFFER</span>
              </div>
            </div>
            <div class="offer-title">
              <span>${offer.title}</span>
            </div>
          `;
          container.appendChild(div);
        }
      });
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setupOfferList);
    } else {
      setupOfferList();
    }
  </script>
{% endif %}